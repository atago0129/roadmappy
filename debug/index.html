<html>
  <head>
  </head>
  <body>
    <div id="roadmappy" data-hoge="hogehoge"></div>
    <script src="/dist/roadmappy.min.js"></script>
    <script>
      var roadmappy = new window.Roadmappy.default(
        {
          target: "roadmappy",
          type: "assignee",
          style: {
            "barHeight": 20,
            "timeFormat": "%-m月%-d日", // required d3 time format
            "tickInterval": "utcMonday" // required d3 interval format
          }
        },
        {
          "tasks":[
            {"id":1,"name":"Dev","from":"2017-11-21","to":"2017-12-9","color":"#F81D1D","story":1,"assignee":2,"involvement":30},
            {"id":2,"name":"QA","from":"2017-12-10","to":"2017-12-31","color":"#bdb76b","story":1,"assignee":[1,3]},
            {"id":3,"name":"Dev","from":"2017-12-1","to":"2017-12-9","color":"#7fff00","story":2,"assignee":3},
            {"id":4,"name":"QA","from":"2018-1-1","to":"2015-2-15","color":"#8b008b","story":2,"assignee":2},
            {"id":5,"name":"Hoge","from":"2018-1-2","to":"2018-1-15","color":"#8b008b","story":1,"assignee":2}
          ],
          "stories":[
            {"id":1,"name":"Project A"},
            {"id":2,"name":"Project B"}
          ],
          "assignees":[
            {"id":1,"name":"Paul","order":10},
            {"id":2,"name":"John","order":5},
            {"id":3,"name":"Joe","order":7}
          ]
        }
      );
      roadmappy.render();
      roadmappy.on('click:task', function(task) {
        task.to = new Date(task.to.getTime() + 1000 * 60 * 60 * 24);
        roadmappy.render();
      });
      roadmappy.on('drag:start:task:from', drag.bind(null, 'from', false));
      roadmappy.on('drag:drag:task:from', drag.bind(null, 'from', false));
      roadmappy.on('drag:end:task:from', drag.bind(null, 'from', true));
      roadmappy.on('drag:start:task:to', drag.bind(null, 'to', false));
      roadmappy.on('drag:drag:task:to', drag.bind(null, 'to', false));
      roadmappy.on('drag:end:task:to', drag.bind(null, 'to', true));
      function drag(key, reorder, task, pos) {
        const xScale = roadmappy.canvas.xScale;
        task[key] = xScale.invert(pos.x);
        if (reorder) roadmappy.roadmap.reorder();
        roadmappy.render();
      }

      roadmappy.on('drag:start:task', move.bind(null, false));
      roadmappy.on('drag:drag:task', move.bind(null, false));
      roadmappy.on('drag:end:task', move.bind(null, true));
      function move(reorder, task, pos) {
        const xScale = roadmappy.canvas.xScale;
        const width = xScale(task.to) - xScale(task.from);
        task.from = xScale.invert(pos.x - width / 2);
        task.to = xScale.invert(pos.x + width / 2);
        if (reorder) roadmappy.roadmap.reorder();
        roadmappy.render();
      }
      window.roadmappy = roadmappy;
    </script>
  </body>
</html>

